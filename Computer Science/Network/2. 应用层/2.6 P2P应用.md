# 基本特点
只存在极少甚至没有一直运行的服务器。
任意端系统直接通信
利用peer服务能力
peer节点间歇上网，IP随时动态变化。
# 例子
- 文件分发 BitTorrent
- 流媒体 KanKan
- VoIP Skype
# CS vs P2P
![[截屏2024-07-19 上午9.15.38.png]]
## CS
- 所有节点都从服务器下载。
- 探究一个服务时间下限：
	- $N$ clients
		- download bandwidth: ${d_1, d_2, ..., d_N}$
	- $1$ server
		- upload bandwidth: $U_S$
	- All clients need to download a file, whose size is $F$.
	- So the longest serving time is $\max{(\frac{F}{d_{min}}, \frac{N\times F}{U_S})}$.
		- The bottom limitation.
		- As the amount of the clients, $N$, goes up to a huge number, $\frac{F}{d_{min}}$ can be ignored, and this time is unbearable.
# P2P
- 首先从客户端的角度来说
	- 最慢的那个客户端所用时间是下限。
	- 所需时间$\frac{F}{d_{min}}$
- 其次从服务器的角度来说
	- 所需时间：$\frac{N\times F}{U_S + \sum_{i=1}^N{U_i}}$
	- 除了服务器可以upload这个文件，其他获得部分该文件的peer节点也能够利用自己的upload带宽来上传文件。
- 所以总下限：$\max{(\frac{F}{d_{min}},\frac{N\times F}{U_S + \sum_{i=1}^N{U_i}})}$
- 随着用户数增加，服务时间下限趋于稳定。
- 整个网络的服务能力随着客户端的上线下线具有高度的动态性，难以管理。
# 非结构化P2P
- 在应用层上
	- peer 和 peer 之间为了互通有无 建立了 逻辑的连接，称为overlay。
- peer节点之间构成的overlay是随机的，任意的，叫做非结构化P2P
## 集中化目录 
- Napster [[2.1 应用层协议原理#1.3.1. Napster系统]]
	- 资源如何定位——目录定位
	- 节点加入和退出——节点管理
	- 集中式的文件目录与分布式的文件传输![[Pasted image 20240719094039.png]]
		- 单点故障：目录服务器挂掉就G了。
		- 性能瓶颈：客户端太多，查询请求会导致中心目录服务器负载太大。
		- 侵犯版权：只能惩罚目录服务器的维护者。
## 完全分布式
- Gnutella
- 文件共享协议和代码都开放
- 没有中心服务器
- flooding 洪泛查询：广度优先搜索式地查询。
- 问题：不能有环，否则查询无法终止。
	- 设置有限的TTL。
	- 中转节点记录查询行为，避免多次经过。
	- 
# 结构化P2P  DHT (Distribution Hash Table)
- peer节点之间构成的overlay是结构化的，符合某种复杂关系的。
- 