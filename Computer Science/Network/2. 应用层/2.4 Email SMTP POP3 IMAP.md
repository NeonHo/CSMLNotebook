# 1. 用户代理 User Agent
- 代理用户完成一系列协议动作的软件。
- Email中，撰写、发送，接收邮件的客户端软件。
	- OutLook
- [[2.2 Web & HTTP#1. Web]]应用中，浏览器是用户的用户代理。
- [[2.3 FTP]]应用中，文件传输客户端软件是用户代理。
# 2. 邮件服务器
- 守候在25号端口。
- 发送 [[#3. 邮件发送：SMTP 简单邮件传输协议]]
	- 第一跳
		- 用户代理发送给邮件服务器。
		- 邮件服务器将邮件入队。
	- 第二跳
		- 邮件服务器将队列中的邮件依次出队发出。
		- 发出到相应的目标邮件服务器中。
		- 这些目标邮件服务器中的Mail Box用来接收对应收件人的邮件。
- 第三跳：
	- 用户代理联系到自己的邮件服务器，并从其内部的相应Mail Box中拉取收到的邮件（[[#4. 邮件拉取：POP3、IMAP、HTTP]]）。
![[Pasted image 20240715165632.png]]
# 3. 邮件发送：SMTP 简单邮件传输协议
- 握手
- 传报文
	- 报文均为ASCII码，可抓包可读。
		- 无论是请求还是响应
		- 还是邮件本身
		- 均为ASCII码
			- 如果正文为中文，采用MIME(Multimedia Mail Extension)多媒体扩展
			- 采用Base64编码。
	- 有状态码及其解释。
- 关闭
![[Pasted image 20240715170943.png]]
- 持久连接，两个不同厂商的邮件服务器之间建立连接后，连接不关的，直到所有该发的邮件发完再关。
## 3.1. SMTP vs HTTP
 - HTTP一般是不可持续的[[2.2 Web & HTTP#1.2.1. 非持续 HTTP 1.0]]
 - HTTP用于拉取邮件，而SMTP是发送协议。
 - HTTP和SMTP都要求ASCII明文报文
	 - 命令和响应交互都是ASCII码
 - HTTP报文往往只包含其他对象的URL，不包含对象本身。
	 - 一个响应报文至多一个对象。
 - SMTP报文中，邮件包含的所有附件都包含在这一个发送报文。
## 3.2. Base64编码
- 发送时，将若干个不在ASCII编码范围内的Byte，转换为更长的在ASCII码范围内的字符。
- 对方再根据Base64映射关系，将ASCII字符解释称不在范围内的原始Byte。
- 再用MIME解释这些Byte。
![[Pasted image 20240716173048.png]]
# 4. 邮件拉取：POP3、IMAP、HTTP
![[Pasted image 20240716173218.png]]
## 4.1. POP3 (Post Office Protocol)
- 仅仅能区分收件箱和发件箱。
- 三个阶段：
	- 用户确认阶段
		- 客户端：申明用户名，口令。
		- 服务器响应：OK，ERR。
	- 事务处理阶段
## 4.2. IMAP
- 还能够进行远程目录维护。
	- 能够维护收件箱和发件箱内部的文件目录结构。
## 4.3. HTTP
- Hotmail
- Yahoo!
