# 1. 网络核心
路由器的网状网络
# 2. 数据的网络传输
## 2.1. 电路交换 Circuit Switching
![[Pasted image 20240504163911.png]]
![[Pasted image 20240504170132.png]]
- 交换节点之间的带宽分片
	- 交换节点之间的带宽较宽，可复用。
	- 时分多路复用 Time-division multiplexing TDM；
		- 1.536 Mbps的带宽，分为24个时槽 slot，每个时槽的带宽为64 Kbps.
	- 频分多路复用 Frequency-division multiplexing FDM；
	- 波分多路复用 Wave-division multiplexing （光纤通信，可用波段是可分的）。
- 通过信令系统 为两个主机 建立 独享的物理线路
	- 选择各段线路中，没有被占用的一片，
	- 多段串联，
	- 构成独享线路。
- 独享线路能够保证传输质量，但是容易导致信道资源浪费。
- 常应用于传统电话网络。
## 2.2. 分组交换 Packet Switching
- 电路交换的问题
	- 计算机的服务使用往往具有很强的突发性，电路交换不适用。
		- 线路建立而不传输，是浪费资源。
	- 线路交换需要很长的建立连接的时间；
	- 不可靠：如果网络核心中的关键节点损毁，影响的通信范围将会非常广。
- 分组交换特征
	- 不再多路复用，要用全用。
		- 一个主机与另一个主机，要用这条线路，将使用该条线路的全部带宽。
	- 以分组（packet）为单位。
		- 将大的传输文件分成一个个包裹。
		- 方式：存储转发
			- 每个数据交换节点将一个包裹的全部数据存下来，然后查转发表，排队在对应方向的其他分组后，等待排队结束后转发传递给下一个节点。
			- 目的是，每两个交换节点之间的线路能够在空闲时供其他源和目标之间使用，从而节约链路资源，按需使用。
			- 如果不存储转发，将退化为面向连接且不多路复用的恶化情况。
	- 相较于电路交换，在每个交换节点上耽误了一个packet完全存储到节点的时延，还耽误了一个不确定的排队时延，但是换取了链路资源的共享。
	- **排队延迟与丢失：** 排队的队列长度被人为设定为有限长（缓存受限），如果超出这个限制（到达速率$>$ 输出速率），包将被丢弃，无法入队。
- 一段数据的发送和接收是一个行为的两种视角，也可以理解为发送和接收花费的是一段时间，发送的第一个bit到达接收端的那一刻，就开始不停地接收。
- 网络核心的主要功能：
	- 转发
		- 局部地
		- 从路由器的输入链路接收存储，并转发到输出链路。
	- 路由
		- 全局
		- 通过路由实体根据路由算法计算，维护路由表，
		- 明确指定一个分组从源到目标的整个路径。
- 分组交换是一种特殊的时分多路复用——==统计多路复用==。
	- 划分时间片的方式不再依赖固定的算法模式。
### 2.3.1. 数据报网络 datagram
- 计算机网络时分组交换建立的网络，按照网络层有无连接分为**数据报网络**和**虚电路网络**
- 数据报网络
	- 源主机发送给目标主机的数据报携带目标主机的完整地址。
		- 交换节点不维护主机间通信状态。
	- 不需要通信前握手。
	- 每个分组的传递独立于彼此。
	- 根据路由表，以存储转发方式传递。
- 因为路由表在变，同一个目标IP地址的不同数据报走的是不同路径时，存在失序的可能。
### 2.3.2. 虚电路网络 virtual circuit （有连接，而非[[1.2 网络边缘#]]）
- 通信前先握手
- 这条链路上的交换节点维护两主机见的通信状态，建立一个虚拟的电路。
	- 通过信令系统建立虚电路
	- 虚电路表项
		- 分组来自的节点地址，以及分组当前使用的虚电路号。
		- 表项同行的输出部分对应的输出方向交换节点地址，以及分组发送出去时要使用的虚电路号。
	- 根据输入交换节点的前一个节点的虚电路号对应的那个输出虚电路号，一跳一跳地存储转发。
	- 虚电路号在传递过程中可能发生变化。
- 每个分组携带虚电路号。
- 交换节点按照虚电路号存储转发。
## 2.3. 电路交换 vs 分组交换
- 电路交换时，一条链路能够支撑的同时活跃用户数$n_{max}=\frac{B}{b}$, 其中$B$是该链路的带宽，$b$是每个用户活跃时需要独占的传输带宽。
- 分组交换时，我们假设整条带宽被占满甚至超过是这条链路无法支撑的全部情况。
	- 假设每个用户的活跃概率为$p$。
	- 我们通过排列组合得知该跳链路撑不住的概率为$C^{n_{max}}_{N}p^{n_{max}}p^{N-n_{max}}$。
	- 这个值通常非常小，所以使用分组交换时，可支持的用户数为$N$。
	- 注意：这里如果真实活跃人数达到$n_{max}$，将导致通信强度爆炸而崩溃，所以也算在链路无法支撑的情况之内。
- 注意：如果$N$非常大，即使活跃概率本身较小，同时活跃用户仍然非常大，会造成拥塞甚至崩溃，所以分组交换不是一劳永逸的。
	- 需要预警
	- 需要从拥塞到正常的恢复。
- 电路交换仍具有必要性
	- 现代网络由分组交换构成，例如一般的**数据报网络**，但电路交换仍然具有必要性。
	- 流媒体——机顶盒等多媒体应用场景
		- 让分组交换表现得像电路交换。
