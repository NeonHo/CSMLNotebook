在文本生成模型（如 GPT、BART、LLaMA 等）中，**temperature（温度）** 是一个关键的解码参数，用于控制生成文本的**随机性（多样性）与确定性（连贯性）**。它通过调整模型输出概率分布的“陡峭程度”，影响最终生成结果的风格和质量。

---

### **一、temperature 的作用原理**

文本生成模型（尤其是自回归模型）的核心是**预测下一个词的概率分布**：给定前文序列，模型会计算词汇表中每个词作为下一个词的概率（记为 $P(w|context)$）。例如，生成“今天天气很____”时，模型可能输出“好”的概率为 80%，“热”为 15%，“冷”为 5%。

temperature 的作用是对这个概率分布进行**重参数化**，公式如下：

$$
P_{\text{new}}(w) = \frac{\exp\left(\frac{\log P(w)}{\tau}\right)}{\sum_{w'} \exp\left(\frac{\log P(w')}{\tau}\right)}
$$

其中：

- $\tau$ 即 temperature（温度值）；
- $\log P(w)$ 是模型原始输出的对数概率（避免数值溢出）；
- 分母是归一化项，确保新概率分布的和为 1。

---

### **二、temperature 对生成结果的影响**

温度值的大小直接改变概率分布的“形状”，进而影响生成文本的特性：

#### 1. 当 $\tau = 1.0$（默认值）

- 概率分布与模型原始输出一致，生成结果**平衡了多样性和连贯性**。
- 示例：模型倾向于选择高概率词，但偶尔会尝试低概率词，避免过于单调。

#### 2. 当 $\tau \to 0^+$（接近 0，如 0.1、0.3）

- 概率分布会**极度陡峭**：高概率词的概率被放大，低概率词的概率几乎被忽略。
- 生成结果**确定性强、连贯性高**，但**多样性差**，可能重复或僵化（如反复生成“的”“是”）。
- 适合场景：需要精准、严谨的文本（如技术文档生成）。

#### 3. 当 $\tau > 1.0$（如 1.5、2.0）

- 概率分布会**趋于平缓**：高概率词的优势被削弱，低概率词有更多机会被选中。
- 生成结果**多样性高、创意性强**，但**连贯性下降**，可能出现逻辑混乱或无意义的词（如“今天天气很苹果”）。
- 适合场景：需要发散思维或创意的文本（如诗歌、故事生成）。

#### 4. 当 $\tau = 0$（极端情况）

- 直接选择概率最高的词（即**贪心搜索**），生成结果完全确定，但可能陷入局部最优（如重复短句）。

---

### **三、temperature 与其他解码策略的关系**

temperature 常与其他解码策略配合使用，共同控制生成效果：

- **贪心搜索（Greedy Search）**：始终选择概率最高的词，等价于 $\tau \to 0$，但易重复。
- **束搜索（Beam Search）**：保留 top-K 个候选序列，通过 temperature 调整候选词的概率分布，平衡多样性和准确性。
- **随机采样（Stochastic Sampling）**：按概率分布随机选词，temperature 是核心参数，直接决定采样的随机性。
- **top-p 采样（核采样）**：只从累积概率超过 p 的词中采样，结合 temperature 可进一步控制多样性（如 $p=0.9$ 且 $\tau=0.7$）。

---

### **四、实际应用中的调优建议**

1. **默认起点**：先用 $\tau=1.0$ 生成，观察结果的连贯性和多样性。
2. **减少重复/增强连贯**：降低 temperature（如 0.7~0.9），抑制低概率词的干扰。
3. **增加创意/避免僵化**：提高 temperature（如 1.1~1.3），但不宜过高（超过 2.0 易失控）。
4. **任务适配**：
   - 生成任务（如写小说）：$\tau=0.8 \sim 1.2$；
   - 问答任务（如客服回复）：$\tau=0.5 \sim 0.8$；
   - 诗歌/创意写作：$\tau=1.2 \sim 1.5$。
5. **动态调整**：部分模型支持按生成阶段动态调整 temperature（如开头用高温度发散，结尾用低温度收束）。

---

### **总结**

temperature 是文本生成中控制“随机性-确定性”平衡的核心参数，其本质是通过调整概率分布的陡峭程度，影响下一词选择的多样性：

- **低温度（τ→0）**：生成文本更确定、连贯，但缺乏变化；
- **高温度（τ>1）**：生成文本更多样、创意，但可能混乱；
- **适中温度（τ=1）**：平衡多样性与连贯性，适用于多数场景。

理解 temperature 的作用，能帮助我们根据具体任务需求，灵活调整生成策略，获得更符合预期的文本结果。