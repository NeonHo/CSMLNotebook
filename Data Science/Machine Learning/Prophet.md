Prophet是由Meta（原Facebook）开发的[[时间序列预测]]算法，于2017年开源。它的核心设计目标是**降低时间序列预测的门槛**，让非专业人士也能快速生成可靠的预测结果，尤其适用于商业场景（如销量、流量、用户增长等）中常见的时间序列数据。


### 一、Prophet的核心特点
- **易用性**：无需深入掌握时间序列分析知识，通过简单的API即可实现预测，支持Python和R语言。
- **鲁棒性**：对缺失值、异常值不敏感，能处理常见的时间序列问题（如趋势变化、季节性、节假日影响）。
- **可解释性**：将时间序列分解为趋势、季节性、特殊事件等可解释的成分，结果直观。
- **不确定性估计**：自动输出预测区间，量化预测的不确定性。


### 二、模型原理：时间序列分解
Prophet的核心思想是将时间序列**分解为多个可解释的成分**，并通过组合这些成分进行预测。其数学表达式为：

$$y(t) = g(t) + s(t) + h(t) + \varepsilon(t)$$

其中：
- $y(t)$：$t$时刻的观测值；
- $g(t)$：**趋势函数**（trend），捕捉时间序列的长期变化趋势（如增长或下降）；
- $s(t)$：**季节性函数**（seasonality），捕捉周期性波动（如年度、月度、周度季节性）；
- $h(t)$：**节假日/特殊事件函数**（holidays），捕捉一次性或重复出现的特殊事件影响（如春节、促销活动）；
- $\varepsilon(t)$：误差项，假设为独立同分布的正态噪声。[[正态分布]]


#### 1. 趋势函数 $g(t)$：捕捉长期变化
趋势函数描述时间序列在“去除季节性和特殊事件”后的长期走势，Prophet提供两种趋势模型：


##### （1）线性趋势（Linear Trend）
适用于无约束的增长/下降场景（如用户数持续增长，无明显饱和迹象），表达式为：

$$g(t) = k \cdot t + m$$

- $k$：增长率（正数为增长，负数为下降）；
- $m$：偏移量（$t=0$时的基准值）。

但实际中，趋势可能随时间变化（如增长放缓），因此Prophet引入**趋势突变点**（changepoints）：允许增长率$k$在特定时间点发生变化。例如，在$t=c$处，增长率从$k$变为$k + \delta_c$，其中$\delta_c$是突变点的调整量。


##### （2）逻辑增长趋势（Logistic Trend）
适用于有“饱和上限”的场景（如市场容量有限，用户数不会无限增长），表达式为：

$$g(t) = \frac{C(t)}{1 + \exp(-k \cdot (t - m))}$$

- $C(t)$：容量（capacity），表示时间序列的最大值（可随时间变化，如市场规模扩大）；
- $k$：增长率；
- $m$：趋势的中点（$g(m) = C(m)/2$）。

逻辑趋势同样支持趋势突变点，通过调整增长率$k$适应变化（如增长到一定阶段后放缓）。


#### 2. 季节性函数 $s(t)$：捕捉周期性波动
季节性是时间序列中随固定周期重复的模式（如年度季节性：夏季销量高，冬季低；周度季节性：周末流量高）。Prophet通过**傅里叶级数**建模季节性，兼顾灵活性和稳定性。

对于周期为$P$（如年度$P=365.25$天，周度$P=7$天）的季节性，表达式为：

$$s(t) = \sum_{n=1}^N \left( a_n \cos\left(\frac{2\pi n t}{P}\right) + b_n \sin\left(\frac{2\pi n t}{P}\right) \right)$$

- $N$：傅里叶阶数（控制季节性的灵活性），$N$越大，季节性模式越复杂（但可能过拟合）；
- $a_n, b_n$：待估计的参数，决定季节性的幅度和相位。

实际使用中，Prophet会根据周期自动推荐$N$（如年度季节性$N=10$，周度$N=3$），也可手动调整。


#### 3. 节假日与特殊事件 $h(t)$
用于捕捉非周期性但已知的特殊事件（如春节、双十一促销）的影响。模型假设每个事件对$y(t)$的影响是一个常数，表达式为：

$$h(t) = \sum_{i=1}^L \kappa_i \cdot 1_{\{t \in D_i\}}$$

- $D_i$：第$i$个事件的日期集合（如$D_i$可表示每年春节的日期）；
- $\kappa_i$：第$i$个事件的影响强度（正数为促进，负数为抑制）；
- $1_{\{t \in D_i\}}$：指示函数（$t$在$D_i$中时为1，否则为0）。

用户可通过输入自定义事件列表（如促销日期），模型会自动学习这些事件的影响。


#### 4. 误差项 $\varepsilon(t)$
假设为独立同分布的正态噪声，即$\varepsilon(t) \sim \mathcal{N}(0, \sigma^2)$，其中$\sigma$为噪声标准差。


### 三、参数估计：贝叶斯推断
Prophet通过**Stan**（一种概率编程语言）实现参数估计，支持两种模式：
- **最大后验估计（MAP）**：快速得到点估计，适合大规模数据；
- **贝叶斯采样**：通过MCMC（马尔可夫链蒙特卡洛）生成参数后验分布，可得到更可靠的预测区间，但计算成本较高。

核心是通过优化目标函数（负对数似然）求解参数（如趋势增长率$k$、季节性系数$a_n/b_n$、事件影响$\kappa_i$等）。


### 四、优势与适用场景
#### 优势：
1. **对数据质量要求低**：可处理缺失值（自动线性插值）和异常值（通过设置“预测区间上下限”过滤异常值）；
2. **灵活应对趋势变化**：自动检测趋势突变点（也可手动指定），适应增长放缓、加速等场景；
3. **内置季节性处理**：无需手动指定周期，自动识别年度、周度等季节性；
4. **支持自定义事件**：轻松添加节假日、促销等特殊事件，提升预测精度；
5. **输出预测区间**：通过贝叶斯推断提供不确定性估计（如95%置信区间）。


#### 适用场景：
- 商业预测（销量、营收、用户数等）；
- 时间粒度为**小时、日、周、月**的常规数据；
- 数据包含明显趋势和季节性；
- 有已知特殊事件（如节假日）影响的场景。


### 五、局限性
1. **不适合高频数据**：对分钟级、秒级数据效果较差（季节性建模基于固定周期，难以捕捉高频波动）；
2. **依赖历史数据量**：至少需要几个周期的历史数据（如年度季节性需1年以上数据）；
3. **对非线性趋势敏感**：复杂非线性趋势（如混沌序列）可能预测偏差较大；
4. **过度平滑风险**：默认参数可能过度平滑短期波动，需手动调参优化。


### 六、使用流程（以Python为例）
1. **安装库**：`pip install prophet`；
2. **准备数据**：需包含两列：`ds`（日期，格式为datetime）和`y`（观测值）；
3. **拟合模型**：
   ```python
   from prophet import Prophet
   # 初始化模型
   model = Prophet(yearly_seasonality=True, weekly_seasonality=True)
   # 添加节假日（可选）
   model.add_country_holidays(country_name='CN')  # 中国节假日
   # 拟合数据
   model.fit(df)  # df为包含ds和y的DataFrame
   ```
4. **生成预测**：
   ```python
   # 创建未来日期DataFrame（如预测365天）
   future = model.make_future_dataframe(periods=365)
   # 预测
   forecast = model.predict(future)
   ```
5. **可视化结果**：
   ```python
   fig1 = model.plot(forecast)  # 预测趋势图
   fig2 = model.plot_components(forecast)  # 分解为趋势、季节性、节假日
   ```


### 总结
Prophet是一款“开箱即用”的时间序列预测工具，通过分解时间序列为趋势、季节性和特殊事件，结合贝叶斯推断实现稳健预测。它平衡了易用性和准确性，尤其适合非专业人士处理商业场景中的常规预测问题。但在使用时需注意其局限性，必要时通过调参（如调整季节性阶数、趋势灵活性）优化结果。