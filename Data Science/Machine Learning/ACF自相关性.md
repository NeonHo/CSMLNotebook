ACF（Autocorrelation Function，自相关函数）是时序分析中用于衡量序列自身相关性的核心工具，它描述了时序数据在不同滞后阶数下的线性依赖关系。以下从定义、原理、计算方法到应用场景进行详细解析：


### **一、ACF的定义**
自相关函数（ACF）用于衡量时序数据$y_t$在滞后$k$阶时，当前值$y_t$与滞后$k$期值$y_{t-k}$之间的线性相关程度，记为$\rho_k$。其数学定义基于**自协方差**（衡量变量与自身滞后项的协变程度）标准化得到：

1. **自协方差（Autocovariance）**  [[协方差矩阵]]
   对于平稳时序数据（均值$\mu$恒定，方差$\sigma^2$恒定），滞后$k$阶的自协方差为：
   $$
   \gamma_k = \text{Cov}(y_t, y_{t-k}) = E[(y_t - \mu)(y_{t-k} - \mu)]
   $$
   其中$E[\cdot]$表示期望，$k$为滞后阶数（$k=0,1,2,\dots$）。当$k=0$时，$\gamma_0 = \text{Var}(y_t) = \sigma^2$（即序列的方差）。

2. **自相关系数（ACF值）**  
   自相关系数是自协方差的标准化结果（消除量纲影响），取值范围为$[-1, 1]$：
   $$
   \rho_k = \frac{\gamma_k}{\gamma_0} = \frac{E[(y_t - \mu)(y_{t-k} - \mu)]}{E[(y_t - \mu)^2]}
   $$
   当$\rho_k > 0$时，序列存在**正自相关**（如今天的温度与昨天正相关）；$\rho_k < 0$时为**负自相关**（如股票价格短期回调）。


### **二、样本ACF的计算**
实际应用中，时序数据是有限样本（记为$y_1, y_2, \dots, y_n$），需通过样本估计ACF，记为$\hat{\rho}_k$。计算步骤如下：

1. 计算样本均值：
   $$
   \bar{y} = \frac{1}{n} \sum_{t=1}^n y_t
   $$

2. 计算样本自协方差：
   $$
   \hat{\gamma}_k = \frac{1}{n} \sum_{t=k+1}^n (y_t - \bar{y})(y_{t-k} - \bar{y}) \quad (k=0,1,\dots,n-1)
   $$
   （注：部分教材中分母用$n-k$代替$n$，以减少偏差，但实际应用中$n$较大时差异可忽略。）

3. 计算样本自相关系数：
   $$
   \hat{\rho}_k = \frac{\hat{\gamma}_k}{\hat{\gamma}_0}
   $$


### **三、ACF图（自相关图）**
ACF的结果通常通过**ACF图**（横轴为滞后阶数$k$，纵轴为$\hat{\rho}_k$）直观展示，图中还会标注**置信区间**（通常为$\pm 1.96/\sqrt{n}$，基于白噪声假设）：

- 若$\hat{\rho}_k$落在置信区间外，说明该滞后阶数的自相关显著不为0；
- 若落在区间内，则可认为自相关不显著（接近白噪声，[[时间序列预测基本概念#**11. 白噪声（White Noise）**]]）。

例如：
- 平稳序列的ACF通常随$k$增大而逐渐衰减至0；
- 非平稳序列（如随机游走）的ACF衰减缓慢，甚至长期显著不为0；
- 季节性序列的ACF在季节性滞后阶数（如$k=12$ for 月度数据）处会出现显著峰值。


### **四、ACF的核心作用**
1. **判断序列平稳性**  [[时间序列预测基本概念#**6. 平稳性（Stationarity）**]]
   平稳序列的ACF通常**快速衰减**（如指数衰减或正弦衰减），而非平稳序列（如含趋势或单位根）的ACF衰减缓慢，甚至在高滞后阶数下仍显著不为0。例如：
   - 随机游走（非平稳）的ACF在$k=1,2,\dots$时均接近1，衰减极慢；
   - 平稳AR(1)序列的ACF呈指数衰减（$\rho_k = \phi_1^k$）。

2. **识别模型类型与阶数**  
   ACF是选择时序模型的关键依据：
   - **移动平均（MA）模型**：MA(q)的ACF在$k > q$时会**突然截尾**（$\rho_k = 0$），因此ACF图中截尾的位置即为$q$的估计值；
   - **自回归（[[AR自回归]]）模型**：AR(p)的ACF通常**逐渐衰减**（不截尾），需结合偏自相关函数（PACF）判断阶数；
   - **混合模型（如[[ARIMA]]）**：需结合ACF和PACF共同分析。

3. **诊断模型拟合效果**  
   模型残差应近似为白噪声（无显著自相关）。若残差的ACF图中存在显著非零值，说明模型未充分捕捉序列的相关性，需调整模型结构（如增加阶数）。


### **五、ACF与PACF的区别**
ACF衡量的是$y_t$与$y_{t-k}$的**总相关性**（包含中间滞后项的间接影响），而**偏自相关函数（PACF）** 衡量的是**剔除中间滞后项（$y_{t-1}, \dots, y_{t-k+1}$）影响后，$y_t$与$y_{t-k}$的净相关性**。

两者分工常用于模型识别：
- ACF用于识别MA模型阶数（截尾特性）；
- PACF用于识别AR模型阶数（截尾特性）。


### **六、ACF的局限性**
1. 仅衡量**线性相关性**，无法捕捉非线性依赖关系（如$y_t$与$y_{t-k}^2$的关系）；
2. 样本ACF受样本量影响较大，小样本下估计误差可能较大；
3. 对于非平稳序列，ACF的解释力有限，需先通过差分等方法转化为平稳序列再分析。


### **七、应用示例**
以月度气温数据为例：
- 滞后1阶（$k=1$）的ACF显著为正（今天与昨天温度相关）；
- 滞后12阶（$k=12$）的ACF可能显著为正（今年1月与去年1月温度相关，体现季节性）；
- ACF图中$k=12,24,\dots$处的峰值可提示序列存在年度季节性。


### **总结**
ACF是时序分析的“显微镜”，通过量化不同滞后阶数的自相关性，帮助判断序列平稳性、识别模型结构并诊断拟合效果。理解ACF的计算原理和图形解读，是掌握时序建模（如AR、MA、ARMA等）的基础。在实际应用中，ACF常与PACF配合使用，形成时序模型识别的核心工具。